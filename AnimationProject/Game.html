<html class="fullscreen">
<head>
<title>Game!</title>    
</head>
<style>
    /*html, body,canvas {
      width:  100%;
      height: 100%;
      margin: 0px;
    }*/
    fullscreen,body,html{
        width:  100%;
        height: 100%;
        margin: 0px;    
    }

    .fullscreen .btn{
        position: absolute;     
    }
    .fullscreen .text{
            position: absolute;
    }
    .fullscreen .circle{
        border-radius: 50%;
        width: 2%;
        height: 4%;
        position: absolute;
    }
    
    
    .fullscreen .myProgress {
        width: 100%;
        background-color: white;
        position: absolute;
        top:40%;
        height:10%;
        
        
    }

    .fullscreen .myBar {
        width: 100%;
        height:100%;
        background-color: blue;
        text-align: center;
        font-size: 200%;
        color: white;  
    }

</style>
<body>
    <canvas   id="canvas"  onmousemove="MousePos(event)"  > </canvas>
    
    <div class="myProgress" id="myProgress"><div class="myBar" id="myBar">cdscs</div></div>
    
    <div class="circle" id="goodHealth" style="background-color:green;top:1%;left:0%;visibility:hidden;"></div>
    <h3 class="text" id="goodHealthText" style="top:0%;left:2%;visibility:hidden;">100</h3>
    <div class="circle" id="goodAttack" style="background-color:red;top:1%;left:10%;visibility:hidden;"></div>
    <h3 class="text" id="goodAttackText" style="top:0%;left:12%;visibility:hidden;">100</h3>
    <div class="circle" id="goodDefense" style="background-color:blue;top:1%;left:20%;visibility:hidden;"></div>
    <h3 class="text" id="goodDefenseText" style="top:0%;left:22%;visibility:hidden;">100</h3>
    <div class="circle" id="evilHealth" style="background-color:green;top:1%;left:70%;visibility:hidden;"></div>
    <h3 class="text" id="evilHealthText" style="top:0%;left:72%;visibility:hidden;">100</h3>
    <div class="circle" id="evilAttack" style="background-color:red;top:1%;left:80%;visibility:hidden;"></div>
    <h3 class="text" id="evilAttackText" style="top:0%;left:82%;visibility:hidden;">100</h3>
    <div class="circle" id="evilDefense" style="background-color:blue;top:1%;left:90%;visibility:hidden;"></div>
    <h3 class="text" id="evilDefenseText" style="top:0%;left:92%;visibility:hidden;">100</h3>
    
    <h3 class="text" id="goodText" style="top:15%;left:30%;visibility:hidden;">Good Text</h3>
    <h3 class="text" id="evilText" style="top:15%;left:60%;visibility:hidden;">Evil Text</h3>
    <!--<h1 class="text" style="top:30%;left:45%;width:10%;height:10%;"><font color="white"></font></h1>-->
    <!--Now The Game Menus -->
    <!--First Menu-->
    <button class="btn" id="one_player" style="top:40%;left:45%;width:10%;height:10%;">One Player</button>
    <button class="btn" id="two_players" style="top:60%;left:45%;width:10%;height:10%;">Two Players</button>
    <!--Game Menu-->
    <button class="btn" id="Attack" style="top:80%;left:10%;width:10%;height:10%;background-color:red;border-color:red;visibility:hidden;">Attack</button>
    <button class="btn" id="Defense" style="top:80%;left:45%;width:10%;height:10%;background-color:blue;border-color:blue;color:white;visibility:hidden;">Defense</button>
    <button class="btn" id="Health" style="top:80%;left:80%;width:10%;height:10%;background-color:green;border-color:green;visibility:hidden;">Health</button>
    <button class="btn" id="Evolve" style="top:80%;left:80%;width:10%;height:10%;visibility:hidden;">Power Up</button>
    <!--Choose level Menu-->
    <button class="btn" id="lv1" style="top:80%;left:10%;width:10%;height:10%;visibility:hidden">lv1</button>
    <button class="btn" id="lv2" style="top:80%;left:45%;width:10%;height:10%;visibility:hidden">lv2</button>
    <button class="btn" id="lv3" style="top:80%;left:80%;width:10%;height:10%;visibility:hidden">lv3</button>
    <!--Return button-->
    <button class="btn" id="return" style="top:90%;left:0%;width:5%;height:10%;visibility:hidden">Return</button>
    

</body>
<script>
    var canvas=document.getElementById("canvas");
    var context=canvas.getContext("2d");  
    var mouse=[0,0];//x and y
    
    canvas.width=window.innerWidth;
    canvas.height=window.innerHeight;
    canvas.addEventListener("touchmove",TouchMove,false);

    var GoodAttacks=[];
    var GoodDefense=[];
    var GoodEvolve;
    var EvilAttacks=[];
    var EvilDefense=[];
    var EvilEvolve;
    var Intro=[];
    var Idle=[];
    var actualAnimationRunning;
    var menu;
    var startTime;
    var time=0;
    var dt;
    
    //integer with only two values 0,1 that decides if one or two player mode
    var oneplayer;
    //integer with only two values 0,1 that decides who is the player selecting menus
    var goodTurn;
    
    
    class Menu{
        
        constructor(){
            this.Buttons={};
            this.Buttons["OnePlayer"]=document.getElementById("one_player");
            this.Buttons["TwoPlayers"]=document.getElementById("two_players");
            this.Buttons["goodHealth"]=document.getElementById("goodHealth");
            this.Buttons["goodAttack"]=document.getElementById("goodAttack");
            this.Buttons["goodDefense"]=document.getElementById("goodDefense");
            this.Buttons["goodHealthText"]=document.getElementById("goodHealthText");
            this.Buttons["goodAttackText"]=document.getElementById("goodAttackText");
            this.Buttons["goodDefenseText"]=document.getElementById("goodDefenseText");
            this.Buttons["evilHealth"]=document.getElementById("evilHealth");
            this.Buttons["evilAttack"]=document.getElementById("evilAttack");
            this.Buttons["evilDefense"]=document.getElementById("evilDefense");
            this.Buttons["evilHealthText"]=document.getElementById("evilHealthText");
            this.Buttons["evilAttackText"]=document.getElementById("evilAttackText");
            this.Buttons["evilDefenseText"]=document.getElementById("evilDefenseText");
            this.Buttons["Attack"]=document.getElementById("Attack");
            this.Buttons["Defense"]=document.getElementById("Defense");
            this.Buttons["Evolve"]=document.getElementById("Evolve");
            this.Buttons["Health"]=document.getElementById("Health");
            this.Buttons["return"]=document.getElementById("return");
            this.Buttons["LoadingBar"]=document.getElementById("myBar");
            this.Buttons["BarBehind"]=document.getElementById("myProgress");
            this.Buttons['lv1']=document.getElementById("lv1");
            this.Buttons['lv2']=document.getElementById("lv2");
            this.Buttons['lv3']=document.getElementById("lv3");
            
            this.Buttons['GoodText']=document.getElementById("goodText");
            this.Buttons['EvilText']=document.getElementById("evilText");
            
            //variables
            this.oneplayer=false;
            this.twoplayers=false;
           
            //booleans
            this.Selected={};
            this.Selected['Attack']=false;
            this.Selected['Defense']=false;
            this.Selected['Evolve']=false;
            this.Selected['Health']=false;
            this.Selected['lv1']=false;
            this.Selected['lv2']=false;
            this.Selected['lv3']=false;
            this.Selected['return']=false;
            
            //AddEventListeners
            this.Buttons["OnePlayer"].addEventListener("click",this.OnePlayer,false);
            this.Buttons["TwoPlayers"].addEventListener("click",this.TwoPlayers,false);
            this.Buttons["Attack"].addEventListener("click",function(){menu.Select('Attack')},false);
            this.Buttons["Defense"].addEventListener("click",function(){menu.Select('Defense')},false);
            this.Buttons["Evolve"].addEventListener("click",function(){menu.Select('Evolve')},false);
            this.Buttons["Health"].addEventListener("click",function(){menu.Select('Health')},false);
            this.Buttons["lv1"].addEventListener("click",function(){menu.Select('lv1')},false);
            this.Buttons["lv2"].addEventListener("click",function(){menu.Select('lv2')},false);
            this.Buttons["lv3"].addEventListener("click",function(){menu.Select('lv3')},false);
            this.Buttons["return"].addEventListener("click",function(){menu.Select('lv3')},false);
        }
        moveBar(percentage){
            //change text
            this.Buttons['LoadingBar'].innerHTML=percentage+'%';
            //change bar
            this.Buttons['LoadingBar'].style.width=percentage+"%";
        }
        
        Select(option){
            menu.Selected[option]=true;
        }
        
        ShowIdleMenus(){
            menu.Buttons["Attack"].style.visibility="visible";
            menu.Buttons["Defense"].style.visibility="visible";
            menu.Buttons["Evolve"].style.visibility="visible";
            menu.Buttons["goodHealth"].style.visibility="visible";
            menu.Buttons["goodAttack"].style.visibility="visible";
            menu.Buttons["goodDefense"].style.visibility="visible";
            menu.Buttons["goodHealthText"].style.visibility="visible";
            menu.Buttons["goodAttackText"].style.visibility="visible";
            menu.Buttons["goodDefenseText"].style.visibility="visible";
            menu.Buttons["evilHealth"].style.visibility="visible";
            menu.Buttons["evilAttack"].style.visibility="visible";
            menu.Buttons["evilDefense"].style.visibility="visible";
            menu.Buttons["evilHealthText"].style.visibility="visible";
            menu.Buttons["evilAttackText"].style.visibility="visible";
            menu.Buttons["evilDefenseText"].style.visibility="visible";
        }
        
        OnePlayer(){
            
            /*HideButtons();
            time=0
            actualAnimationRunning=Idle[0];
            menu.ShowIdleMenus();*/
            menu.oneplayer=true;
            //menu.Buttons["return"].style.visibility="visible";
            
        }
        TwoPlayers(){
            //Afterwars change to work with two players
            /*HideButtons();
            time=0
            actualAnimationRunning=Idle[0];
            menu.ShowIdleMenus();*/
            menu.twoplayers=true;
        }
        
        
       
    }
    class Game{
        
        constructor(){
            //-1 Nothing State
            //0-idle state, 1-calulator game,2-Process winning choice,3-Do winning animation,
            //4-Update players status with text and idle animation, 5- is there a winner,
            this.state=-1;
            //
            this.idle_state=0;
            //
            this.calculator_state=0;
            //
            this.ActionAnimationState=0;
            //
            this.update_status_state=0;
            
            
            
        }
        //
        Nothing(){
            // do nothing
            if(menu.oneplayer){
                this.state++;
            }
            if(menu.twoplayers){
                this.state++;
            }
        }
        //
        Idle(){
            if(menu.oneplayer){
                
            }
            if(menu.twoplayers){
                // Wait for good player choice
                if(this.idle_state==1){
                    this.menu.Buttons['GoodText'].innerHTML='<font color="blue">First Player(Good) Choose Option!</font>';
                    //Just see the first selection menu
                    if(menu.Selected['Attack']){
                        
                    }
                    if(menu.Selected['Attack']){
                        
                    }
                    if(menu.Selected['Attack']){
                        
                    }
                    if(menu.Selected['Attack']){
                        
                    }
                    this.idle_state++;
                }
                // Select Idle animation as current
                if(this.idle_state==0){
                    HideButtons();
                    time=0;
                    actualAnimationRunning=Idle[0];
                    menu.ShowIdleMenus();
                    this.idle_state++;
                }
            }
        }
        //
        Calculator(){
            
        }
        //
        ProcessWinningChoice(){
            
        }
        //
        ActionAnimation(){
            
        }
        //
        UpDateStatus(){
            
        }
        //
        CheckWinner(){
            
        }
        //
        GameOver(){
            
        }
        
        //Main function of this class that is called once per frame 
        //does Actions depending on this.state
        Run(){
            if(this.state==-1){
                this.Nothing();
            }
            if(this.state==0){
                this.Idle();
            }
            if(this.state==1){
                this.Calculator();
            }
            if(this.state==2){
                this.ProcessWinningChoice();
            }
            if(this.state==3){
                this.ActionAnimation();
            }
            if(this.state==4){
                this.UpDateStatus();
            }
            if(this.state==5){
                this.CheckWinner();
            }
            if(this.state==6){
                this.GameOver();
            }
            
        }
        
    }
    
    
    function HideButtons(){
            
            for(key in menu.Buttons){
                var value = menu.Buttons[key];
                /* use key/value for intended purpose */
                value.style.visibility="hidden";
            }
    }
    
    function readTextFile(file)
    {
        var rawFile = new XMLHttpRequest();
        rawFile.open("GET", file, false);
        rawFile.onreadystatechange = function ()
        {
            if(rawFile.readyState === 4)
            {
                if(rawFile.status === 200 || rawFile.status == 0)
                {
                    var allText = rawFile.responseText;
                    //alert(allText);
                    //return parseInt(allText);
                }
            }
        }
        rawFile.send(null);
        return rawFile.responseText;
    }    


    function TouchMove(e){
        mouse[0]=e.touches[0].clientX;
        mouse[1]=e.touches[0].clientY;
    }    

    function MousePos(e){
        mouse[0]=e.clientX;
        mouse[1]=e.clientY;
        //console.log(mouse);
    } 
    
    function loadImage(src) {
        try{
            var img = new Image();
            img.src = src;
            img.isReady = false;
            img.onload = function() {
                img.isReady = true;
            };
            return img;
        }
        catch(err){
            console.log("Error loading Image");
        }
    }

    function get_all_animations(stages){
        var s=new String();
        var adressMenu="images/Intro/";
        var adressIdle="images/Idle/";
        var adressGoodAttacks="images/GoodAttacks/";
        var adressGoodDefense="images/GoodDefense/";
        var adressGoodEvolve="images/GoodEvolve/";
        var adressEvilAttacks="images/EvilAttacks/";
        var adressEvilDefense="images/EvilDefense/";
        var adressEvilEvolve="images/EvilEvolve/";
        var loading=100/8;
        
        if(stages==0){
            menu.moveBar(loading*stages);
            //Get Intro Images
            var number_of_folders=parseInt(readTextFile(adressMenu+"/Index.txt"));
            console.log("Numeber:"+number_of_folders);
            var animation_images=[];
            var finalAdress;
            for(j=0;j<number_of_folders;j++){
                almost_final_adress=adressMenu+j+"/";
                number_of_images=parseInt(readTextFile(almost_final_adress+"Index.txt"));
                for(i=0;i<number_of_images;i++){
                    finalAdress=almost_final_adress+i+".jpg";
                    try{animation_images[i]=loadImage(finalAdress);}
                    catch(err){console.log("Error Loading Image");haveFiles=false;}
                }
                Intro.push(animation_images);
            }
        }
        if(stages==1){
            menu.moveBar(loading*stages);
            //Get Idle Images
            var number_of_folders=parseInt(readTextFile(adressIdle+"/Index.txt"));
            console.log("Numeber:"+number_of_folders);
            var animation_images=[];
            var finalAdress;
            for(j=0;j<number_of_folders;j++){
                almost_final_adress=adressIdle+j+"/";
                number_of_images=parseInt(readTextFile(almost_final_adress+"Index.txt"));
                for(i=0;i<number_of_images;i++){
                    finalAdress=almost_final_adress+i+".jpg";
                    try{animation_images[i]=loadImage(finalAdress);}
                    catch(err){console.log("Error Loading Image");haveFiles=false;}
                }
                Idle.push(animation_images);
            }
        }
        if(stages==2){
            menu.moveBar(loading*stages);
            //Get GoodAttacks Images
            var number_of_folders=parseInt(readTextFile(adressGoodAttacks+"/Index.txt"));
            console.log("Numeber:"+number_of_folders);
            var animation_images=[];
            var finalAdress;
            for(j=0;j<number_of_folders;j++){
                almost_final_adress=adressGoodAttacks+j+"/";
                number_of_images=parseInt(readTextFile(almost_final_adress+"Index.txt"));
                for(i=0;i<number_of_images;i++){
                    finalAdress=almost_final_adress+i+".jpg";
                    try{animation_images[i]=loadImage(finalAdress);}
                    catch(err){console.log("Error Loading Image");haveFiles=false;}
                }
                GoodAttacks.push(animation_images);
            }
        }
        if(stages==3){
            menu.moveBar(loading*stages);
             //Get EvilDefense Images
            var number_of_folders=parseInt(readTextFile(adressEvilDefense+"/Index.txt"));
            console.log("Numeber:"+number_of_folders);
            var animation_images=[];
            var finalAdress;
            for(j=0;j<number_of_folders;j++){
                almost_final_adress=adressEvilDefense+j+"/";
                number_of_images=parseInt(readTextFile(almost_final_adress+"Index.txt"));
                for(i=0;i<number_of_images;i++){
                    finalAdress=almost_final_adress+i+".jpg";
                    try{animation_images[i]=loadImage(finalAdress);}
                    catch(err){console.log("Error Loading Image");haveFiles=false;}
                }
                EvilDefense.push(animation_images);
            }
        }
        if(stages==4){
            menu.moveBar(loading*4);
            //Get EvilAttacks Images
            var number_of_folders=parseInt(readTextFile(adressEvilAttacks+"/Index.txt"));
            console.log("Numeber:"+number_of_folders);
            var animation_images=[];
            var finalAdress;
            for(j=0;j<number_of_folders;j++){
                almost_final_adress=adressEvilAttacks+j+"/";
                number_of_images=parseInt(readTextFile(almost_final_adress+"Index.txt"));
                for(i=0;i<number_of_images;i++){
                    finalAdress=almost_final_adress+i+".jpg";
                    try{animation_images[i]=loadImage(finalAdress);}
                    catch(err){console.log("Error Loading Image");haveFiles=false;}
                }
                EvilAttacks.push(animation_images);
            }
        }
        if(stages==5){
            menu.moveBar(loading*stages);
            //Get GoodDefense Images
            var number_of_folders=parseInt(readTextFile(adressGoodDefense+"/Index.txt"));
            console.log("Numeber:"+number_of_folders);
            var animation_images=[];
            var finalAdress;
            for(j=0;j<number_of_folders;j++){
                almost_final_adress=adressGoodDefense+j+"/";
                number_of_images=parseInt(readTextFile(almost_final_adress+"Index.txt"));
                for(i=0;i<number_of_images;i++){
                    finalAdress=almost_final_adress+i+".jpg";
                    try{animation_images[i]=loadImage(finalAdress);}
                    catch(err){console.log("Error Loading Image");haveFiles=false;}
                }
                GoodDefense.push(animation_images);
            }
        }
        if(stages==6){
            menu.moveBar(loading*stages);
            //GetGoodPowerUps
            GoodEvolve={
                'Health':[],
                'Defense':[],
                'Attack':[]
            };
            var animation_images=[];
            var finalAdress;
            var j=0;
            //
            for(key in GoodEvolve){

                almost_final_adress=adressGoodEvolve+key+"/";
                number_of_folders=parseInt(readTextFile(almost_final_adress));
                number_of_images=parseInt(readTextFile(almost_final_adress+j+"/Index.txt"));
                for(i=0;i<number_of_images;i++){
                    finalAdress=almost_final_adress+j+"/"+i+".jpg";
                    try{animation_images[i]=loadImage(finalAdress);}
                    catch(err){console.log("Error Loading Image");haveFiles=false;}
                }
                GoodEvolve[key].push(animation_images);
                if(j<number_of_folders)
                    j++;
            }
        }
        if(stages==7){
            menu.moveBar(loading*stages);
            //GetEvilPowerUps
            EvilEvolve={
                'Health':[],
                'Defense':[],
                'Attack':[]
            };
            var animation_images=[];
            var finalAdress;
            j=0;
            //
            for(key in EvilEvolve){

                almost_final_adress=adressEvilEvolve+key+"/";
                number_of_folders=parseInt(readTextFile(almost_final_adress));
                number_of_images=parseInt(readTextFile(almost_final_adress+j+"/Index.txt"));
                for(i=0;i<number_of_images;i++){
                    finalAdress=almost_final_adress+j+"/"+i+".jpg";
                    try{animation_images[i]=loadImage(finalAdress);}
                    catch(err){console.log("Error Loading Image");haveFiles=false;}
                }
                EvilEvolve[key].push(animation_images);
                if(j<number_of_folders)
                    j++;
            }
            menu.moveBar(100);
        }
    } 
    
   
    function Draw(images_array){
            dt = 1E-3 * (new Date().getTime() - startTime);
            startTime = new Date().getTime();
            time += dt%10000;
        
            var index=Math.floor((time*60))%(images_array.length);
            //console.log(index);
            var frame = images_array[index];
            if(frame.isReady ){
                context.drawImage(frame,0,0,window.innerWidth,window.innerHeight); 
            }
            
    }
    
    
    var image_index=0;
    var stages=0;
    var firstTime=true;
    function Main(){
         canvas.width=window.innerWidth;
        canvas.height=window.innerHeight;
        if(stages<8){
            get_all_animations(stages);
            stages++;
        }
        else{
            //image=Intro[0][i];
            //context.drawImage(Intro[0][image_index],0,0,window.innerWidth,window.innerHeight);
            //image_index=(image_index+1)%Intro[0].length;
            if(firstTime){
                startTime = new Date().getTime();
                actualAnimationRunning=Intro[0];
                menu.Buttons['BarBehind'].style.visibility="hidden";
                menu.Buttons['LoadingBar'].style.visibility="hidden";
                menu.Buttons['OnePlayer'].style.visibility="visible";
                menu.Buttons['TwoPlayers'].style.visibility="visible";
                firstTime=false;
            }
            if(menu.oneplayer){
                
            }
            if(menu.twoplayers){
                
            }
            
            
            Draw(actualAnimationRunning);
        }
        
        window.requestAnimationFrame(Main);
    }
    function Init(){
        menu=new Menu();
        HideButtons();
        menu.Buttons['BarBehind'].style.visibility="visible";
        menu.Buttons['LoadingBar'].style.visibility="visible";
        /*get_all_animations();
        menu.Buttons['BarBehind'].style.visibility="hidden";
        menu.Buttons['LoadingBar'].style.visibility="hidden";
        menu.Buttons['OnePlayer'].style.visibility="visible";
        menu.Buttons['TwoPlayers'].style.visibility="visible";*/
        //startTime = new Date().getTime();
        //actualAnimationRunning=Intro[0];
    }
    
    //Main________________________________________
   
    
    
    Init();
    window.requestAnimationFrame(Main);
    //setInterval(Main,10);    
</script>
</html>